#!/bin/bash

# Function to open a file or folder in VS Code
open_in_vscode() {
    local target_path="$1"
    # On macOS, the command is "code" by default
    code "$target_path"
}

# Function to copy the directory path
copy_directory_path() {
    local target_path="$1"
    echo -n "$target_path" | pbcopy  # On macOS, we use pbcopy to copy to the clipboard
    echo "Directory path copied to clipboard: $target_path"
}

# Function to list files and folders with a specific name
list_files_and_folders() {
    local search_name="$1"
    local base_directories=("${@:2}")
    local files=()
    local folders=()

    # Find files and folders with the specified name in base directories and their subdirectories
    for base_directory in "${base_directories[@]}"; do
        # Find files
        while IFS= read -r -d '' file; do
            files+=("$file")
        done < <(find "$base_directory" -type f -iname "*$search_name*" -print0)

        # Find folders
        while IFS= read -r -d '' folder; do
            if [ "$folder" != "$base_directory" ]; then
                folders+=("$folder")
            fi
        done < <(find "$base_directory" -mindepth 1 -type d -iname "$search_name" -print0)
    done

    # Print the list of files and folders
    printf "\033[1mFiles and folders with the name '%s':\033[0m\n" "$search_name"
    printf "\033[1m\033[31m0: EXIT\033[0m\n" # Exit option in bold red
    for (( i=0; i<"${#files[@]}"; i++ )); do
        printf "\033[1m\033[32m%d: \033[0m\033[95m\"%s\"\033[0m\n" $((i+1)) "${files[$i]}"  # Green color for numbers, pink for files
    done
    for (( i=0; i<"${#folders[@]}"; i++ )); do
        printf "\033[1m\033[32m%d: \033[0m\033[96m\"%s\"\033[0m\n" $((i+1+${#files[@]})) "${folders[$i]}"  # Green color for numbers, teal for folders
    done

    # Prompt user to select a file or folder
    read -rp $'\033[1mEnter the number corresponding to the file or folder you want to select:\033[0m ' choice

    # Check user choice
    if [[ "$choice" =~ ^[0-9]+$ ]] && [ "$choice" -ge 0 ] && [ "$choice" -le "$(( ${#files[@]} + ${#folders[@]} ))" ]; then
        if [ "$choice" -eq 0 ]; then
            echo -e "\033[1m\033[31mExiting.\033[0m"
            exit 0
        elif [ "$choice" -le "${#files[@]}" ]; then
            open_in_vscode "${files[$((choice-1))]}"
        else
            local folder_index=$(( choice - ${#files[@]} - 1 ))
            local selected_folder="${folders[$folder_index]}"
            echo "Selected folder: $selected_folder"
            
            # Prompt user to choose action
            read -rp $'\033[1mDo you want to open in VS Code or copy its directory path?\n\n\033[0m\033[1m\033[32m1: \033[0mOpen in VS Code\033[0m\n\033[1m\033[32m2: \033[0mCopy directory path\033[0m\n\033[1m\033[31m0: \033[0mEXIT\033[0m\n\n\033[1mChoice:\033[0m ' action_choice

            case "$action_choice" in
                0)
                    echo -e "\033[1m\033[31mExiting.\033[0m"
                    exit 0
                    ;;
                1)
                    open_in_vscode "$selected_folder"
                    ;;
                2)
                    copy_directory_path "$selected_folder"
                    ;;
                *)
                    echo -e "\033[1m\033[31mInvalid choice. Exiting.\033[0m"
                    exit 1
                    ;;
            esac
        fi
    else
        echo -e "\033[1m\033[31mInvalid selection. Exiting.\033[0m"
        exit 1
    fi
}

# Main function
main() {
    # Specify the base directories
    base_directories=(
        "/Users/ludvigrieff/Desktop/42/Cursus"
        "/Users/ludvigrieff/Desktop/42/Settings"
        # Add more base directories as needed
    )

    # Check if an argument is provided
    if [ $# -eq 0 ]; then
        echo "Usage: ./find <search_name>"
        exit 1
    fi

    search_name="$1"

    # List files and folders with the specified name
    list_files_and_folders "$search_name" "${base_directories[@]}"
}

main "$@"
